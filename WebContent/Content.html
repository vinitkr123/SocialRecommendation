<script>
	var placeSearch, autocomplete;
	var componentForm = {
		street_number : 'short_name',
		route : 'long_name',
		locality : 'long_name',
		administrative_area_level_1 : 'short_name',
		country : 'long_name',
		postal_code : 'short_name'
	};

	function initAutocomplete() {
		// Create the autocomplete object, restricting the search to geographical
		// location types.
		autocomplete = new google.maps.places.Autocomplete(
		/** @type {!HTMLInputElement} */
		(document.getElementById('autocomplete')), {
			types : [ 'geocode' ]
		});

		// When the user selects an address from the dropdown, populate the address
		// fields in the form.
		autocomplete.addListener('place_changed', fillInAddress);
	}

	function fillInAddress() {
		// Get the place details from the autocomplete object.
		var place = autocomplete.getPlace();

		for ( var component in componentForm) {
			document.getElementById(component).value = '';
			document.getElementById(component).disabled = false;
		}

		// Get each component of the address from the place details
		// and fill the corresponding field on the form.
		for (var i = 0; i < place.address_components.length; i++) {
			var addressType = place.address_components[i].types[0];
			if (componentForm[addressType]) {
				var val = place.address_components[i][componentForm[addressType]];
				document.getElementById(addressType).value = val;
			}

			var map = new google.maps.Map("", {
				zoom : 1,
				center : {
					lat : -34.397,
					lng : 150.644
				}
			});
			var geocoder = new google.maps.Geocoder();
			geocodeAddress(geocoder, map);

		}
	}

	function geocodeAddress(geocoder, resultsMap) {

		var address = document.getElementById('autocomplete').value;
		geocoder
				.geocode(
						{
							'address' : address
						},
						function(results, status) {
							if (status === 'OK') {
								resultsMap
										.setCenter(results[0].geometry.location);
							} else {
								alert('Geocode was not successful for the following reason: '
										+ status);
							}
							document.getElementById('longlat').value = results[0].geometry.location;
						});
	}

	// Bias the autocomplete object to the user's geographical location,
	// as supplied by the browser's 'navigator.geolocation' object.
	function geolocate() {
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function(position) {
				var geolocation = {
					lat : position.coords.latitude,
					lng : position.coords.longitude,
				};
				// alert(geolocation);
				var circle = new google.maps.Circle({
					center : geolocation,
					radius : position.coords.accuracy
				});
				autocomplete.setBounds(circle.getBounds());
			});
		}
	}
</script>

<script>
	var map;
	var service;
	var infowindow;

	function initialize() {
		var map;
		var service;
		var infowindow;
		var data;

		var latlong = document.getElementById('latitude').innerHTML;

		var txtSearch = document.getElementById('txtSearch').value;
		var pyrmont = new google.maps.LatLng(latlong);

		map = new google.maps.Map(document.getElementById('map'), {
			center : pyrmont,
			zoom : 15
		});

		var request = {
			location : pyrmont,
			radius : '500',
			query : txtSearch
		};
		service = new google.maps.places.PlacesService(map);
		service.textSearch(request, callback);

	}

	function callback(results, status) {
		var data = [];
		var senddata = {};
		var photos={};
		if (status == google.maps.places.PlacesServiceStatus.OK) {
			for (var i = 0; i < results.length; i++) {
				var place = results[i];
				debugger;
				//alert(place.photos);
				//alert(google.maps.places.PlacesServiceStatus.place.photos[i].getUrl({maxWidht:300}));
				debugger;
				data.push({
					"formatted_address" : place.formatted_address,
					"icon" : place.icon,
					"name" : place.name,
					"rating" : place.rating,
					"user_ratings_total" : place.user_ratings_total
				});
								
			}
			debugger;
			callajax(data);
		}

		function createMarker(place) {
			var marker = new google.maps.Marker({
				map : map,
				position : place.geometry.location
			});

			google.maps.event.addListener(marker, 'click', function() {
				infowindow.setContent(place.name);
				infowindow.open(map, this);
			});
		}

	}

	function callajax(data) {
		var mydata = JSON.stringify(data);
		debugger;
		$.ajax({
			url : "RecommendationHome",
			type : "POST",
			data : {
				"searchdata" : mydata
			},
			success : function(msg) {
				document.getElementById("page").innerHTML=msg;
				//createDataTable(msg)
			},
			error : function() {
				alert("error occurred while making ajax call;");
			}
		});
	};
</script>

<script>
function check()
{
	if(document.getElementById('locationenabled').checked)
		{
		enable('selectbasic');
		enable('selectdistance');
		enable('addressinput');
		}
	else
		{
		disable('selectbasic');
		disable('selectdistance');	
		disable('addressinput');
		
		}
}

function disable(id)
{
	document.getElementById(id).disabled = true;
	}
function enable(id)
{
	document.getElementById(id).disabled = false;
	}

</script>

<style>
.container {
	margin-top: 20px;
	float: left;
}
</style>
<div
	style="width: 1024px; float: left; margin-left: 25px; border: 2px solid #535C58; border-radius: 4px;">
	<!-- Select Basic -->
	<div class="form-group">
		<div
			style="width: 100%; padding-bottom: 25px; padding-left: 60px; padding-top: 20px;">
			<div style="width: 70%; float: left;">
				<input type="text" name="txtSearch" id="txtSearch"
					style="width: 100%; border: 0px; height: 47px; border-radius: 4px; padding-left: 10px; font-size: 30px"
					placeholder="Search here" />

			</div>
			<div style="width: 30%; float: left">

				<!-- <input type="button"
					style="style="background-color: #800000; float: left; width: 38%; height: 36px; margin-left: 20px; padding: 12px 20px 0px 20px; text-align: center; border-radius: 4px;""
					value="Search" id="btnsearch" onclick="initialize();" /> -->

				<div
					style="background-color: #800000; float: left; width: 38%; height: 36px; margin-left: 20px; padding: 12px 20px 0px 20px; text-align: center; border-radius: 4px;">
					<a style="font-size: 18px; color: #fff" ><span
						class='glyphicon' onclick="initialize();" >Search</span></a>
				</div>
			</div>
		</div>
		<div id="map"></div>
		<!-- <script
			src="https://maps.googleapis.com/maps/api/place/textsearch/xml?query=restaurants+in+Sydney&key=AIzaSyAbgbsd1R1T4yzOzyJrp5uC3YTy1jIWgHg"
			async defer></script> -->

		<div style="width: 87%;margin-top: 20px;border: 1px solid;height: 70px;padding-left: 8px;margin-left: 58px;margin-right: 80px;border-radius: 4px;float: left; margin-bottom: 18px;">
		<input onclick='check();' type='checkbox' name='locationenabled' id='locationenabled' value='locationenabled' style='float: left; margin-top: 30px; margin-right: 10px;'>
		<label class="control-label" style="padding-top: 17px; float: left; font-size: 24px; color: #3d3d3d;" for="selectbasic" >Type</label>
			<div class="col-md-3" style="padding-top: 11px;width: 16%!important">
				<select id="selectbasic" name="selectbasic" class="form-control" style="box-shadow: 0px 0px 0px 0px; border: 0px;" disabled>
					<option value="amusement_park">amusement_park</option>
					<option value="bar">bar</option>
					<option value="cafe">cafe</option>
					<option value="shopping_mall">shopping_mall</option>
					<option value="museum">museum</option>
					<option value="night_club">night_club</option>
					<option value="restaurant">restaurant</option>
					<option value="tourist_attraction">tourist_attraction</option>
				</select>
			</div>
			<label class="distance-label" style="padding-top: 17px;float:left;font-size: 24px;color: #3d3d3d;margin-left: 26px;" for="selectdistance">Distance</label>
			<div class="col-md-3" style="padding-top: 11px;width: 10%!important" >
			<select disabled id="selectdistance" name="selectdistance" class="form-control" style="box-shadow: 0px 0px 0px 0px;border: 0px;">
					<option value="tenmile">10 miles</option>
					<option value="twentymile">20 miles</option>
					<option value="fiftymile">50 miles</option>
					<option value="hundredmile">100 miles</option>
			</select>
			</div>
			<div style="float: left; padding-top: 11px;">
				<label class="control-label" style="padding-left: 30px; font-size: 24px;margin-top: 6px;" for="textinput">Location</label>
			</div>
					<div class="col-md-3" style="float: left; padding-top: 11px; width: 19% !important">


				<script src="https://cdn.jsdelivr.net/npm/places.js@1.16.6"></script>
				
				<script>
					var placesAutocomplete = places({
						appId : 'social-1571281348700',
						apiKey : 'AIzaSyAbgbsd1R1T4yzOzyJrp5uC3YTy1jIWgHg',
						container : document.querySelector('#address-input')
					});
				</script>
								<input disabled type="text" style="width:100%;border:0px;height:47px;border-radius:4px;padding-left: 15px;" id="addressinput" placeholder="Where are we going?" />

		</div>
	</div>
</div>

<div id="page"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAbgbsd1R1T4yzOzyJrp5uC3YTy1jIWgHg&libraries=places&callback=initAutocomplete" async defer></script> 


